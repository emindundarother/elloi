# Lessons

- Prisma 7 + Node 24 ortamında schema engine migration akışı sorunluysa, uygulamayı bloklamamak için idempotent SQL bootstrap yaklaşımı uygulanabilir.
- Tasarımda kasiyer hızını artırmak için tek ana CTA (`+ Yeni Sipariş`) ve açık siparişlerde satır içi hızlı aksiyonlar kritik.
- Sipariş raporlarının tarihsel doğruluğu için snapshot alanları (ürün adı/fiyat) zorunlu tutulmalı.
- Stok yarış koşullarında sadece UI kontrolü yeterli değil; transaction içinde koşullu update (`stockQty >= qty`) şart.
- Admin düzenleme ekranlarında "anlık submit" yerine tek satır/tek `Kaydet` modeli, yanlışlıkla güncelleme riskini azaltır ve kullanıcıya geri alınabilir düzenleme alanı sağlar.
- Stok takibi gibi boolean yönetim alanları da satırdaki ana formun parçası olmalı; aynı kaydet döngüsünde birleştirmek kullanıcı modelini sadeleştirir.
- Durum gibi kritik bool alanlarda metin + checkbox ikilisi yerine tek tıklanabilir durum butonu, görsel karmaşayı düşürür ve durumu daha hızlı okunur yapar.
- `peer-checked` ile metin geçişi yapılacaksa hedef eleman `peer` ile kardeş olmalı; aksi halde durum etiketi görsel olarak senkronize olmaz.
- Kategori bazlı ürün özelleştirmeleri için sipariş satırında serbest metin yerine yapılandırılmış seçimler kullanmak, operasyonda hatalı/eksik not riskini azaltır.
- Prisma şemasına yeni kolon eklendiğinde mevcut SQLite dosyası için kolon patch'i uygulanmazsa build sırasında page data aşamasında kolon hatası alınır.
- Server action içinde `throw` edilen doğrulama/iş kuralı hataları admin formlarında global error ekranına düşebilir; UI çökmesini önlemek için action içinde yakalayıp kontrollü dönmek gerekir.
- Admin tablolarında form elemanları çoğaldığında satır bazlı dirty-state takibi, kullanıcıya hangi değişikliklerin henüz kaydedilmediğini net gösterir.
- `trackStock` kapalıyken stok adedi girişini UI'da kilitlemek, backend fallback'e güvenmeden önce yanlış veri girişini kaynağında engeller.
- İki parçalı fiyat girişinde (ana ücret + küsürat) backend'e tek alan göndermek için hidden `basePrice` alanı üretmek, API sözleşmesini bozmadan UX beklentisini karşılar.
- Sabit zaman dilimi kullanımı yerine runtime cihaz zaman dilimi kullanmak, farklı cihaz/ortamlarda tarih-saat tutarsızlıklarını azaltır.
- Satır bazlı güncelleme yerine toplu kaydetme gerektiğinde, form alanlarını local draft state'te tutup sadece değişen satırları JSON payload olarak server action'a göndermek daha sade bir yönetim sağlar.
- Gün sonlandırma gibi kritik aksiyonlarda (tek seferlik kapanış), `day` alanında unique kayıt ve zorunlu manuel input (Z raporu toplamı) birlikte kullanılınca veri tutarlılığı belirgin şekilde artar.
- Operasyonel izlenebilirlik için kapanış anında DB kaydı + dosya logu birlikte tutulmalı; log yazımı başarısız olsa da ana işlem geri alınmamalı.
- Dev ortamında global Prisma client cache kullanılırken yeni model eklendiğinde eski instance model delegate'lerini taşımayabilir; runtime guard ile fresh client açmak bu kırılmayı önler.
- Kritik kapanış akışlarında tek büyük CTA + modal doğrulama adımı, yanlış tetiklemeleri azaltırken zorunlu input (Z raporu) disiplinini korur.
- Gün sonu kapanışında yalnızca backend validation yeterli değil; kasa UI ve sipariş oluşturma sayfası da senkron şekilde kilitlenirse kullanıcı deneyimi daha tutarlı olur.
- Operasyonel hataları geri almak için admin'e özel "kapanış sıfırlama" aksiyonu gerektiğinde, DB kaydı ile log satırlarının birlikte temizlenmesi şarttır; aksi halde denetim izi tutarsızlaşır.
- Kullanıcı rol/şifre değişikliklerinde yalnızca seed güncellemek yetmez; canlı DB’de de upsert + listedışı kullanıcıları pasifleştirme adımıyla erişim tutarlılığı sağlanmalı.
- Sipariş detayı birden fazla yüzeyde tüketiliyorsa (UI tablo, rapor, CSV), kasiyer gibi kritik operasyon alanları tüm çıktılarda eşzamanlı güncellenmeli.
- Yıkıcı sipariş aksiyonları (sil/iptal) rapor ekranına eklendiğinde, kullanıcı hatasını önlemek için client-side `confirm` onayı zorunlu tutulmalı.
- Enum tabanlı ödeme tiplerinde isim/değer değişikliği yapılınca, eski kayıtları SQL ile yeni değere map etmek (`TICKET` -> `EDENRED`) runtime enum parse hatalarını önler.
- Ana dashboardda özet metin yerine operasyon blokları (zaman + ana CTA + canlı tablolar) kullanmak kasiyerin karar süresini kısaltır.
- Fiyatı etkileyen özelleştirmelerde sadece frontend toplamını güncellemek yeterli değil; aynı kural backend sipariş hesaplamasında da birebir uygulanmalı.
- Seed ile canlı ürün listesini sıfırlarken `deleteMany` yerine pasife çekme + isim bazlı güncelle/oluştur yaklaşımı, geçmiş sipariş ilişkilerini kırmadan menü reseti sağlar.
- Uzun ürün listelerinde kategori altı grup başlıkları, kasiyerin hedef ürüne erişim süresini belirgin şekilde azaltır; arama olsa da grup yapısı korunmalı.
- Menü gruplaması editlenebilir yapılacaksa, alt kategoriyi veri modelinde ayrı alan olarak tutup sipariş ekranı gruplamasını bu alan üzerinden üretmek uzun vadede daha güvenlidir.
